<div
	class="grid gap-4"
	*ngIf="assignment && assessment && participantFacade.participant$ | async as participant"
>
	<student-mgmt-card>
		<ng-container title>
			<div class="flex gap-4">
				<span>{{ "Domain.Assessment" | translate }}: {{ assignment.name }}</span>
				<student-mgmt-chip
					*ngIf="assessment.isDraft"
					class="draft-chip"
					icon="edit"
					color="orange"
					[text]="'Domain.Draft' | translate"
					data-test="isDraftChip"
				></student-mgmt-chip>
			</div>
		</ng-container>
		<ng-container subtitle>
			<div class="mt-2 flex gap-2">
				<student-mgmt-assignment-type-chip
					[type]="assignment.type"
				></student-mgmt-assignment-type-chip>
				<ng-container [ngSwitch]="assignment.collaboration">
					<student-mgmt-chip
						*ngSwitchCase="collaborationEnum.GROUP"
						icon="groups"
						color="#009664"
						[text]="'Enum.CollaborationType.' + assignment.collaboration | translate"
					></student-mgmt-chip>
					<student-mgmt-chip
						*ngSwitchCase="collaborationEnum.GROUP_OR_SINGLE"
						icon="groups"
						color="#00838f"
						[text]="'Enum.CollaborationType.' + assignment.collaboration | translate"
					></student-mgmt-chip>
					<student-mgmt-chip
						*ngSwitchCase="collaborationEnum.SINGLE"
						icon="person"
						color="#7f23c5"
						[text]="'Enum.CollaborationType.' + assignment.collaboration | translate"
					></student-mgmt-chip>
					<student-mgmt-chip *ngSwitchDefault></student-mgmt-chip>
				</ng-container>
			</div>
		</ng-container>

		<ng-container
			menu
			*ngIf="(participantFacade.participant$ | async).isTeachingStaffMember && assessment"
		>
			<a
				*ngIf="!isEditMode"
				[routerLink]="[
					'/courses',
					courseId,
					'assignments',
					assignment.id,
					'assessments',
					'edit',
					assessment.id
				]"
			>
				<button mat-flat-button class="btn-edit" color="accent">
					{{ "Action.Edit" | translate }}
				</button>
			</a>
		</ng-container>

		<ng-container content>
			<div class="grid">
				<span class="created-by text-light">
					{{ "Common.CreatedBy" | translate }}
					<span class="text font-bold">{{ assessment.creator.displayName }}</span>
					({{ assessment.creationDate | date: "medium" }})
				</span>

				<span class="last-updated-by text-light" *ngIf="assessment.lastUpdatedBy">
					{{ "Common.LastUpdatedBy" | translate }}
					<span class="text font-bold">{{ assessment.lastUpdatedBy.displayName }}</span>
					({{ assessment.updateDate | date: "medium" }})
					<button
						mat-icon-button
						matTooltip="Load edit history"
						(click)="loadAssessmentEvents()"
						*ngIf="participant.isTeachingStaffMember"
					>
						<student-mgmt-icon class="icon-light" name="history"></student-mgmt-icon>
					</button>

					<div
						*ngIf="showEvents && participant.isTeachingStaffMember"
						class="events grid"
					>
						<ng-container *ngIf="assessmentEvents$ | async as events">
							<span *ngFor="let event of events">
								[{{ event.timestamp | date }}] -
								{{ "Property.Assessment.AchievedPoints" | translate }}:
								{{ $any(event.payload).oldScore }} ->
								{{ $any(event.payload).newScore }}
							</span>

							<p *ngIf="events?.length == 0">{{ "Common.None" | translate }}.</p>
						</ng-container>
					</div>
				</span>
			</div>
		</ng-container>
	</student-mgmt-card>

	<student-mgmt-assessment-target
		[group]="assessment.group"
		[targetedParticipant]="assessment.participant"
		[participant]="participant"
		[courseId]="courseId"
	>
	</student-mgmt-assessment-target>
</div>
